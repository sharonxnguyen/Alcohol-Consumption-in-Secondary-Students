---
title: 'PSTAT 131: Final Project'
author: "Sharon Nguyen, Matt Lee, Paul Song"
date: "3/8/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)

library(ISLR)
library(tree)
library(maptree)
```

# Alcohol Consumption in Secondary Students
### By Sharon Nguyen, Matt Lee, Paul Song

 https://www.studyineurope.eu/study-in-portugal/grades




# Abstract



# Introduction

By finding key variables that predict final grades of students within a Portuguese secondary school, we can learn the best ways to provide support for students academically.

# Why we chose this data 

We chose this particular dataset because as college students, final grades matter the most. What we do in our freetime greatly influences our performance in school. Drinking alcohol on a weekend is not uncommon for many college students. This project is relatable in terms of what factors affect us as students. We wanted to take it upon ourselves to investigate a real world problem that we struggle with and can seek knowledge from.

Grades are heavily influenced by a lot of factors. When taking into account final grades, many factors come into play. Did the student have access to internet? How long does it take for the student to get to school? Does the student have a lot of free time on their hands? Or even, did the student spend too much time consuming alcohol? Utilizing the dataset from UCI Machine Learning, our group is attempting to see the significance that certain variables have in predicting a student's final grade.

We  chose to look at the data concerning students in a Portuguese class as it has a total of 649 observations. 

# Why might this model be useful?


# Loading Data and Packages
```{r}
library(gitcreds)
library(dplyr)
dat <- read.csv("student-por.csv")

# Select wanted variables for analysis
data <- dat %>% select(traveltime, studytime, failures, higher, internet, famrel, freetime, goout, Dalc, Walc, health, absences, G3)
str(data)
```


# Variable Analysis

These are the key variables that our final project will utilize within our modeling. A brief explanation of each is provided down below. 

traveltime: home to school travel time (numeric: 1 - <15 min., 2 - 15 to 30 min., 3 - 30 min. to 1 hour, or 4 - >1 hour)

studytime: weekly study time (numeric: 1 - <2 hours, 2 - 2 to 5 hours, 3 - 5 to 10 hours, or 4 - >10 hours)

failures: number of past class failures (numeric: n if 1<=n<3, else 4)

higher: wants to take higher education (binary: yes or no)

internet: Internet access at home (binary: yes or no)

famrel: quality of family relationships (numeric: from 1 - very bad to 5 - excellent)

freetime: free time after school (numeric: from 1 - very low to 5 - very high)

goout: going out with friends (numeric: from 1 - very low to 5 - very high)

Dalc: workday alcohol consumption (numeric: from 1 - very low to 5 - very high)

Walc: weekend alcohol consumption (numeric: from 1 - very low to 5 - very high)

health: current health status (numeric: from 1 - very bad to 5 - very good)

absences: number of school absences (numeric: from 0 to 93)

G3: final grade (numeric: from 0 to 20, output target)

# Data Cleaning

```{r}
# Make variables ordered
data$traveltime <- ordered(data$traveltime, levels = c(1:4), labels = c('1', '2', '3', '4')) 
data$studytime <- ordered(data$studytime, levels = c(1:4), labels = c('1', '2', '3', '4'))
data$failures <- ordered(data$failures, levels = c(0:3), labels = c('0', '1', '2', '3'))
data$higher <- ifelse(data$higher == "yes", 1, 0)
data$internet <- ifelse(data$internet == "yes", 1, 0)

# famrel to health
for(i in 6:11){
  data[,i] <- ordered(data[,i], levels = c(1:5), labels = c('1', '2', '3', '4', '5')) 
}

# view strucutre
str(data)
```

```{r}
# 2 Binary Pass/No Pass
data <- data %>% mutate(grade_2=factor(ifelse(G3/20 >= 0.7, 'Pass', 'No Pass'), 
                                    levels = c('No Pass', 'Pass')))

# # 5 Letter Grading Scale
# data <- data %>% 
#   mutate(grade_5= ifelse(G3/20 >= 18/20, 'A', G3)) %>%
#   mutate(grade_5= ifelse(G3/20 >= 16/20 &&  G3/20 <= 17/20, 'B', G3)) %>%
#   mutate(grade_5= ifelse(G3/20 >= 14/20 &&  G3/20 <= 15/20, 'C', G3)) %>%
#   mutate(grade_5= ifelse(G3/20 >= 12/20 &&  G3/20 <= 13/20, 'D', G3)) %>% 
#   mutate(grade_5= ifelse(G3/20 >= 10/20 &&  G3/20 <= 11/20, 'E', G3))

str(dat)
```



# Data Split
```{r}
set.seed(7)
num_samp <- 0.7 * nrow(data)

# dat <- model.matrix(G3~., student_por)
# 
# train = sample(nrow(dat), num_samp)
# x.train = dat[train, ]
# y.train = student[train, ]$G3
# 
# # The rest as test data
# x.test = dat[-train, ]
# y.test = student[-train, ]$G3


train.indices <- sample(nrow(dat), num_samp)
train <- dat[train.indices,]
test <- dat[-train.indices,]
```

# Exploratory Data Analysis
```{r}
library(reshape2)
library(ggplot2)
# correlation matrix
cor_train <- train %>% mutate(grade=ifelse(G3/20 >= 0.7, 1, 0))

cor_train <- cor_train %>% select(-higher, -internet, -G3)
cormat <- round(cor(cor_train), 2) # says error: 'x' must be numeric
melted_cormat <- melt(cormat)
ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) + 
  geom_raster()

# Get lower triangle of the correlation matrix
get_lower_tri<-function(cormat){
  cormat[upper.tri(cormat)] <- NA
  return(cormat)
}
# Get upper triangle of the correlation matrix
get_upper_tri <- function(cormat){
  cormat[lower.tri(cormat)]<- NA
  return(cormat)
}

upper_tri <- get_upper_tri(cormat)
upper_tri

# Melt the correlation matrix
melted_cormat <- melt(upper_tri, na.rm = TRUE)

# # Heatmap
# ggplot(data = melted_cormat, aes(Var2, Var1, fill = value))+
#  geom_tile(color = "white")+
#  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
#    midpoint = 0, limit = c(-1,1), space = "Lab", 
#    name="Pearson\nCorrelation") +
#   theme_minimal()+ 
#  theme(axis.text.x = element_text(angle = 45, vjust = 1, 
#     size = 12, hjust = 1))+
#  coord_fixed()

reorder_cormat <- function(cormat){
# Use correlation between variables as distance
dd <- as.dist((1-cormat)/2)
hc <- hclust(dd)
cormat <-cormat[hc$order, hc$order]
}

# Reorder the correlation matrix
cormat <- reorder_cormat(cormat)
upper_tri <- get_upper_tri(cormat)
# Melt the correlation matrix
melted_cormat <- melt(upper_tri, na.rm = TRUE)
# Create a ggheatmap
ggheatmap <- ggplot(melted_cormat, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
  theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
    size = 12, hjust = 1))+
 coord_fixed()
# Print the heatmap
print(ggheatmap)


ggheatmap + 
geom_text(aes(Var2, Var1, label = value), color = "black", size = 4) +
theme(
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  panel.grid.major = element_blank(),
  panel.border = element_blank(),
  panel.background = element_blank(),
  axis.ticks = element_blank(),
  legend.justification = c(1, 0),
  legend.position = c(0.6, 0.7),
  legend.direction = "horizontal")+
  guides(fill = guide_colorbar(barwidth = 7, barheight = 1,
                title.position = "top", title.hjust = 0.5))
```
# Decision Tree

```{r}
data.tree <- tree(G3 ~ ., data = train, subset = train.indices)
summary(data.tree)

plot(data.tree)
text(data.tree, pretty = 0, cex = 0.8)
draw.tree(data.tree, cex = 0.5)
```
```{r}
# Pruning 

data.tree.cv <- cv.tree(data.tree, FUN = prune.misclass)
data.tree.cv
```




# Analysis of the Test Set



# Conclusion



# Reference

## An Overview of Your Dataset

The data was obtained in a survey of students' math course in secondary school in Portugal. Called "Student Alcohol Consumption", the dataset can be found on kaggle at <https://www.kaggle.com/uciml/student-alcohol-consumption?select=student-mat.csv>. It includes social, gender, and study information about students. 

In the dataset, we will be dealing with both qualitative and quantitative variables. It contains a total of 395 observations with 33 predictors, containing no missing data. 

## An Overview of Your Research Question

We are interested in predicting the number of times a student consumes alcohol every week. We want to figure out whether variables such as free time and parent's education status has an effect on the number of times a student drinks alcohol each week. Our response variable will be Dalc (Workday alcohol consumption) and Walc (Weekend alcohol consumption) added together to make Alc (Weekly alcohol consumption). 

We believe that the question would be best answered with a regression approach. Of these 33 predictors, we find that final grade, free time, absences, family's education support, study time, parent cohabitation status, parent's education, number of failed classes, quality of family relationship, and going out with friends will be useful for our prediction.

# Comments
Predict G1, G2, and G3
>>>>>>> 95aee943eba5c655bef67038196907c5e720c855
